<!DOCTYPE html>
<html lang="en" class="sr">
<head>
    <meta charset="UTF-8">
    <title>CHAD Compute Cluster</title>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, shrink-to-fit=no, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densityDpi=device-dpi"/>
    <meta name="description"
          content="CHAD is a self-hosted Kubernetes and HPC cluster located in Los Angeles.">
    <meta name="keywords"
          content="CHAD, k8s, hpc, kubernetes, cluster, server, compute, DevOps, infrastructure, self-hosted">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;400&display=swap" rel="stylesheet">
</head>

<body>
<div class="container">

    <div class="headerText">
        <div class="d-inline-block w-100">
            <h1 class="headerText"><b>CHAD</b></h1>
            <h4 class="headerText" style="text-align: right"><b>Written by <a href="https://www.matte.fyi">Matthew Treadwell</a></b></h4>

        </div>
        <h3 class="headerText">A self-hosted, bare metal HPC and Kubernetes cluster</h3>
    </div>

    <div id="main">
        <p>
            CHAD is a self-hosted compute cluster capable of running HPC workloads and Kubernetes.
            This project originally grew from the single dedicated web server I hosted in my closet.
        </p>

        <div class="text-center">
            <img src="img/serverCloset.jpg" alt="Picture of server closet" class="img-fluid rounded mx-auto" style="max-height: 500px">
        </div>

        <h2 class="headerText">Motivation</h2>
        <p>
            Over 5 years ago, I started using Linux and hosting public-facing services from my desktop; mainly, game servers for me and my friends.
            A couple years later, I repurposed an old desktop as a dedicated machine for my services.
            Having a dedicated machine greatly increased reliability, took load off my desktop, and was very easy to manage.
            This worked out well until the machine started to idle at ~70% memory usage, which meant that adding more services wouldn't be feasible.
            Likewise, all of my services were in danger of going down if the memory spiked and ran out during intensive loads.
        </p>
        <p>
            To fix this, I decided to use some of the machines I had lying around and build them into a horizontally scaling cluster.
            Following this approach would allow for my services to scale while also remaining budget friendly.
        </p>

        <h2 class="headerText">Hardware</h2>
        <p>
            The cluster's nodes are divided into the following two groups:
        </p>

        <h4 class="headerText">Infrastructure Nodes</h4>
        <p>Low-power and low performance. Supports the main compute nodes with networking and a high-availability k8s control plane.</p>
        <ul>
            <li>Salieri - Thinkpad X250</li>
            <ul>
                <li>i5 5300u 2c/4t</li>
                <li>8gb ram</li>
            </ul>
            <li>Kuro - ODROID-C2</li>
            <ul>
                <li>Cortex-A53 4c/4t</li>
                <li>2gb ram</li>
            </ul>
        </ul>
        <p>Originally, a Raspberry Pi 3 as part of the control plane, but I removed it due to out-of-memory crashes.</p>
        <h4 class="headerText">Compute Nodes</h4>
        <p>High-power and fast single/multi core speeds. Runs production services.</p>
        <ul>
            <li>Amadeus - Headless Dedicated Machine</li>
            <ul>
                <li>Overclocked i5 3570k 4c/4t</li>
                <li>16gb ram</li>
            </ul>
            <li>Altair - Main Workstation</li>
            <ul>
                <li>Ryzen 3900x 12c/24t</li>
                <li>32gb ram</li>
            </ul>
            <li>Gehenna - Living Room PC</li>
            <ul>
                <li>Overclocked i7 4770k 4c/8t</li>
                <li>16gb ram</li>
            </ul>
        </ul>

        <p>
            This works out to a total of 20 cores, 36 threads, and 64GB of memory for compute resources, which is a huge improvement from the single dedicated machine.
        </p>

        <h2 class="headerText">Design</h2>
        <div class="text-center">
            <img src="img/chadDiagram.png" alt="Picture of server closet" class="img-fluid" style="max-height: 500px">
        </div>

        To put it simply, CHAD is stacked.
        I say stacked because high-availability load balancing is performed on the infrastructure nodes themselves (inside kubernetes).
        This design avoids the need to mess with dedicated load balancers and keeps everything simple to setup.
        In the event that Salieri goes down, Kuro functions as a simple backup.
        Otherwise, control plane requests are split evenly between Kuro and Salieri.



        <h2 class="headerText">Networking</h2>
        <p>
            For security purposes, I won't describe any specific network configurations.
            However, here is a list of the hardware I use for the cluster:
        </p>

        <ul>
            <li>Ubiquiti EdgeRouter Lite</li>
            <li>Juniper Networks EX2200-48P-4G</li>
        </ul>

        <p>
            Overall, everything runs on wired gigabit connections.
            This works fine and isn't prohibitively expensive compared to 10GbE.
            Latency is <1ms between all nodes.
        </p>

        <h2 class="headerText">Services</h2>
        <p>
            CHAD runs a multitude of Open Source software and game servers, both publicly and privately.
            I'm currently migrating services off Amadeus and into the cluster.
        </p>
        <ul>
            <li><b>Metallb</b> - Bare metal load balancing for Kubernetes</li>
            <li><b>Traefik</b> - Kubernetes Ingress controller</li>
            <li><b>Jellyfin</b> - Media streaming</li>
            <li><b>Minecraft</b> - Public PaperMC server</li>
            <li><b>Syncthing</b> - P2P distributed file synchronization</li>
        </ul>

    </div>
</div>
</body>
